{{> navbar }}

<div class="container">
  <div class="d-flex justify-content-between align-items-center my-3">
    <h2>Product Management</h2>
    <a href="/products/add" class="btn btn-success">Add Product</a>
  </div>

  <table class="table">
    <thead>
      <tr class="table-primary">
        <th scope="col">ID</th>
        <th scope="col">Product Name</th>
        <th scope="col">Price</th>
        <th scope="col">Tools</th>
      </tr>
    </thead>
    <tbody>
      {{#each products}}
      <tr>
        <th scope="row">{{this.ProID}}</th>
        <td>{{this.ProName}}</td>
        <td>{{this.Price}}</td>
        <td>
          <button class="btn btn-sm btn-secondary" onclick="viewProduct({{this.ProID}})">View</button>
          <button class="btn btn-sm btn-primary" onclick="editProduct({{this.ProID}})">Edit</button>
          <button class="btn btn-sm btn-danger" onclick="deleteProduct({{this.ProID}})">Delete</button>
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>
</div>

<script>
  function viewProduct(id) {
    window.location.href = `/products/view?id=${id}`;
  }

  function editProduct(id) {
    window.location.href = `/products/edit?id=${id}`;
  }

  async function deleteProduct(id) {
    if (confirm('Are you sure you want to delete this product?')) {
      try {
        // Gửi yêu cầu DELETE đến server để xóa sản phẩm
        const response = await fetch(`/products/delete?id=${id}`, {
          method: 'DELETE',  // Phương thức DELETE
          headers: {
            'Content-Type': 'application/json',
          },
        });

        if (response.ok) {
          alert('Product deleted successfully');
          // Tự động reload trang để cập nhật danh sách sản phẩm
          window.location.reload();
        } else {
          alert('Failed to delete the product');
        }
      } catch (error) {
        alert('Error occurred while deleting product');
        console.error(error);
      }
    }
  }
</script>